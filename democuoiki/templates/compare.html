<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>So s√°nh ph∆∞∆°ng √°n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/csscompare.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        body {
            background-color: white;
        }

        .table td,
        .table th {
            vertical-align: middle;
            text-align: center;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet">
    <style>
        h3.text-center {
            font-family: 'Special Elite', cursive;
            font-size: 40px;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container py-4">
        <h3 class="text-center mb-4">So s√°nh ph∆∞∆°ng √°n</h3>
        <h3 class="text-center mb-4">H·ªó Tr·ª£ L·ª±a Ch·ªçn ƒêi·ªán Tho·∫°i T·ªët Nh·∫•t D·ª±a V√†o Th√¥ng S·ªë Kƒ© Thu·∫≠t Theo Ph∆∞∆°ng Ph√°p AHP
        </h3>

        <div class="d-flex justify-content-between mb-3">
            <button class="btn btn-outline-primary btn-sm" onclick="addCriterion()">+ Th√™m ti√™u ch√≠</button>
            <div>
                <button class="btn btn-outline-success btn-sm" onclick="addOptionColumn()">+ Th√™m ph∆∞∆°ng √°n</button>
                <button class="btn btn-outline-danger btn-sm" onclick="removeOptionColumn()">- X√≥a ph∆∞∆°ng √°n</button>
            </div>
            <button id="btnHistory" class="btn btn-secondary">L·ªãch s·ª≠</button>

            <div id="historyPopup"
                style="display:none; position:absolute; top:60px; right:20px; background:#fff; border:1px solid #ccc; box-shadow:0px 2px 10px rgba(0,0,0,0.1); padding:15px; width:300px; z-index:999;">
                <h5>L·ªãch s·ª≠ Ma Tr·∫≠n</h5>
                <ul id="matrixList" class="list-unstyled mb-0"></ul>

                <h5>L·ªãch s·ª≠ C√°c Ph∆∞∆°ng √Ån</h5>
                <ul id="optionList" class="list-unstyled mb-0"></ul>

                <h5>L·ªãch s·ª≠ Ma Tr·∫≠n So S√°nh C√°c Ph∆∞∆°ng √Ån Theo T·ª´ng Ti√™u ch√≠</h5>
                <h5>L·ªãch s·ª≠ T·ªïng ƒêi·ªÉm C√°c Ph∆∞∆°ng √Ån</h5>

            </div>
        </div>

        <form method="post" action="/result" id="compare-form">
            <table class="table table-bordered" id="comparison-table">
                <thead>
                    <tr id="header-row">
                        <th>Ti√™u ch√≠</th>
                        <th>Ph∆∞∆°ng √°n 1</th>
                        <th>X√≥a ti√™u ch√≠</th>
                    </tr>
                </thead>
                <tbody id="criteria-body">
                    <tr>
                        <td><input type="text" name="criteria[]" class="form-control" placeholder="V√≠ d·ª•: Pin" required>
                        </td>
                        <td>
                            <input type="text" name="option1[]" class="form-control" value="1" required min="0"
                                step="any" oninput="validateInput(this)" onblur="convertFractionToDecimal(this)">
                        </td>

                        <td><button type="button" class="btn btn-danger btn-sm"
                                onclick="removeCriterion(this)">X</button></td>
                    </tr>
                </tbody>
            </table>

            <div class="mb-3">
                <label for="excel-file" class="form-label">Nh·∫≠p d·ªØ li·ªáu t·ª´ Excel:</label>
                <input type="file" class="form-control" id="excel-file" accept=".xlsx, .xls">
            </div>

            <div class="text-center">
                <button type="submit" class="btn btn-success" id="submit-btn">T√≠nh to√°n</button>
            </div>
            <br><br>
        </form>

        <h1>AI D·ª± B√°o Tr∆∞·ªõc Khi T√≠nh AHP</h1>
        <form action="/dudoanai" method="post" enctype="multipart/form-data">
            <label for="file">Ch·ªçn file Excel:</label>
            <input type="file" id="file" name="file" accept=".xlsx" required>
            <br><br>
            <button type="submit">D·ª± ƒëo√°n</button>
        </form>

        {% if result %}
        <h2>Ph∆∞∆°ng √°n t·ªët nh·∫•t n·∫±m ·ªü d√≤ng: {{ best_row }}</h2>
        <pre>{{ result }}</pre>
        {% endif %}

        <h2><br>üìå 1.H∆∞·ªõng d·∫´n ƒë·ªÉ hi·ªÉu v·ªÅ ma tr·∫≠n so s√°nh c·∫∑p ƒë√¥i </br></h2>
        <p>Gi·∫£ s·ª≠ b·∫°n c√≥ <strong>n ti√™u ch√≠</strong> (ho·∫∑c ph∆∞∆°ng √°n), b·∫°n s·∫Ω t·∫°o ra m·ªôt <strong>ma tr·∫≠n vu√¥ng n x
                n</strong> ƒë·ªÉ so s√°nh t·ª´ng c·∫∑p ti√™u ch√≠ v·ªõi nhau.</p>
        <p>V√≠ d·ª• v·ªõi 3 ti√™u ch√≠: C1, C2, C3 ‚Üí t·∫°o ma tr·∫≠n 3x3 nh∆∞ sau:</p>

        <table>
            <tr>
                <th></th>
                <th>C1</th>
                <th>C2</th>
                <th>C3</th>
            </tr>
            <tr>
                <th>C1</th>
                <td>1</td>
                <td>?</td>
                <td>?</td>
            </tr>
            <tr>
                <th>C2</th>
                <td>?</td>
                <td>1</td>
                <td>?</td>
            </tr>
            <tr>
                <th>C3</th>
                <td>?</td>
                <td>?</td>
                <td>1</td>
            </tr>
        </table>

        <h2>üìå 2. Quy t·∫Øc ƒëi·ªÅn gi√° tr·ªã</h2>
        <p>AHP d√πng <strong>thang ƒëo t·ª´ 1 ƒë·∫øn 9</strong> (theo Saaty):</p>

        <table>
            <tr>
                <th>Gi√° tr·ªã</th>
                <th>√ù nghƒ©a</th>
            </tr>
            <tr>
                <td>1</td>
                <td>Hai ti√™u ch√≠ quan tr·ªçng nh∆∞ nhau</td>
            </tr>
            <tr>
                <td>3</td>
                <td>M·ªôt ti√™u ch√≠ h∆°i quan tr·ªçng h∆°n ti√™u ch√≠ kia</td>
            </tr>
            <tr>
                <td>5</td>
                <td>Quan tr·ªçng h∆°n r√µ r·ªát</td>
            </tr>
            <tr>
                <td>7</td>
                <td>R·∫•t quan tr·ªçng</td>
            </tr>
            <tr>
                <td>9</td>
                <td>C·ª±c k·ª≥ quan tr·ªçng</td>
            </tr>
            <tr>
                <td>2,4,6,8</td>
                <td>C√°c m·ª©c trung gian gi·ªØa c√°c m·ª©c tr√™n</td>
            </tr>
            <tr>
                <td>1/x</td>
                <td>N·∫øu ti√™u ch√≠ h√†ng <i>k√©m h∆°n</i> c·ªôt, d√πng ngh·ªãch ƒë·∫£o</td>
            </tr>
        </table>

        <div class="note">
            <strong>L∆∞u √Ω:</strong> ƒê∆∞·ªùng ch√©o ch√≠nh lu√¥n l√† 1 (so v·ªõi ch√≠nh n√≥).<br>
            N·∫øu b·∫°n ƒëi·ªÅn gi√° tr·ªã <code>a<sub>ij</sub></code> ·ªü h√†ng i, c·ªôt j ‚Üí th√¨ √¥ ƒë·ªëi xymmetrical l√†
            <code>a<sub>ji</sub> = 1 / a<sub>ij</sub></code>
        </div>

        <h2>üìå 3. V√≠ d·ª• c·ª• th·ªÉ</h2>
        <p>Gi·∫£ s·ª≠ b·∫°n c√≥ 3 ti√™u ch√≠:</p>
        <ul>
            <li><strong>C1:</strong> Gi√° c·∫£</li>
            <li><strong>C2:</strong> Ch·∫•t l∆∞·ª£ng</li>
            <li><strong>C3:</strong> D·ªãch v·ª•</li>
        </ul>
        <p>B·∫°n ƒë√°nh gi√°:</p>
        <ul>
            <li><strong>C1 so v·ªõi C2:</strong> Ch·∫•t l∆∞·ª£ng quan tr·ªçng h∆°n gi√° c·∫£ m·ªôt ch√∫t ‚Üí C1 vs C2 = 1/3</li>
            <li><strong>C1 so v·ªõi C3:</strong> Gi√° c·∫£ v√† d·ªãch v·ª• quan tr·ªçng nh∆∞ nhau ‚Üí C1 vs C3 = 1</li>
            <li><strong>C2 so v·ªõi C3:</strong> Ch·∫•t l∆∞·ª£ng quan tr·ªçng h∆°n d·ªãch v·ª• r√µ r·ªát ‚Üí C2 vs C3 = 5</li>
        </ul>

        <p>‚áí Ma tr·∫≠n so s√°nh c·∫∑p ƒë√¥i l√†:</p>

        <table>
            <tr>
                <th></th>
                <th>C1</th>
                <th>C2</th>
                <th>C3</th>
            </tr>
            <tr>
                <th>C1</th>
                <td>1</td>
                <td>1/3</td>
                <td>1</td>
            </tr>
            <tr>
                <th>C2</th>
                <td>3</td>
                <td>1</td>
                <td>5</td>
            </tr>
            <tr>
                <th>C3</th>
                <td>1</td>
                <td>1/5</td>
                <td>1</td>
            </tr>
        </table>
    </div>

    <script>
        let optionCount = 1;

        // Danh s√°ch gi√° tr·ªã h·ª£p l·ªá (bao g·ªìm ph√¢n s·ªë v√† s·ªë th·∫≠p ph√¢n t∆∞∆°ng ·ª©ng)
        const validValues = [
            1 / 9, 1 / 8, 1 / 7, 1 / 6, 1 / 5, 1 / 4, 1 / 3, 1 / 2,
            1, 2, 3, 4, 5, 6, 7, 8, 9
        ].map(val => parseFloat(val.toFixed(4)));

        function validateInput(input) {
            let value = input.value.trim();
            let numericValue;

            // B·ªè qua ki·ªÉm tra n·∫øu gi√° tr·ªã ch∆∞a ho√†n ch·ªânh (v√≠ d·ª•: "1/")
            if (value.endsWith('/')) {
                return true; // Ch∆∞a nh·∫≠p xong m·∫´u s·ªë, kh√¥ng b√°o l·ªói
            }

            // X·ª≠ l√Ω n·∫øu l√† ph√¢n s·ªë (ƒë·ªãnh d·∫°ng a/b)
            if (value.includes('/')) {
                const [numerator, denominator] = value.split('/').map(Number);
                if (denominator === 0 || isNaN(numerator) || isNaN(denominator)) {
                    alert('Ph√¢n s·ªë kh√¥ng h·ª£p l·ªá! Vui l√≤ng nh·∫≠p ƒë·ªãnh d·∫°ng a/b (v√≠ d·ª•: 1/9) v·ªõi m·∫´u s·ªë kh√°c 0.');
                    input.value = '';
                    input.focus();
                    return false;
                }
                numericValue = numerator / denominator; // Kh√¥ng l√†m tr√≤n ngay
            } else {
                // Ki·ªÉm tra n·∫øu c√≥ ch·ªØ (kh√¥ng ph·∫£i s·ªë)
                if (isNaN(parseFloat(value)) && value !== '') {
                    alert('Gi√° tr·ªã kh√¥ng h·ª£p l·ªá! Kh√¥ng ƒë∆∞·ª£c nh·∫≠p ch·ªØ, ch·ªâ nh·∫≠p s·ªë ho·∫∑c ph√¢n s·ªë (v√≠ d·ª•: 1/2).');
                    input.value = '';
                    input.focus();
                    return false;
                }
                numericValue = parseFloat(value);
                if (isNaN(numericValue)) {
                    return true; // Cho ph√©p nh·∫≠p s·ªë kh√¥ng h·ª£p l·ªá t·∫°m th·ªùi, s·∫Ω ki·ªÉm tra khi blur
                }
            }

            // Ki·ªÉm tra gi√° tr·ªã ph·∫£i l·ªõn h∆°n 0 v√† trong ph·∫°m vi t·ª´ 1/9 ƒë·∫øn 10
            if (numericValue <= 0 || numericValue < (1 / 10) || numericValue > 10) {
                alert('Gi√° tr·ªã kh√¥ng h·ª£p l·ªá! Vui l√≤ng nh·∫≠p gi√° tr·ªã t·ª´ 1/9, 1/8, 1/7, 1/6, 1/5, 1/4, 1/3, 1/2, 1, 2, 3, 4, 5, 6, 7, 8, 9');
                input.value = '';
                input.focus();
                return false;
            }

            // Ki·ªÉm tra gi√° tr·ªã c√≥ n·∫±m trong danh s√°ch h·ª£p l·ªá kh√¥ng
            const roundedValue = parseFloat(numericValue.toFixed(4));
            if (!validValues.includes(roundedValue)) {
                alert('Gi√° tr·ªã kh√¥ng h·ª£p l·ªá! Ch·ªâ ƒë∆∞·ª£c nh·∫≠p: 1/9, 1/8, 1/7, 1/6, 1/5, 1/4, 1/3, 1/2, 1, 2, 3, 4, 5, 6, 7, 8, 9.');
                input.value = '';
                input.focus();
                return false;
            }

            return true; // Kh√¥ng g√°n l·∫°i value, ƒë·ªÉ convertFractionToDecimal x·ª≠ l√Ω
        }

        function addCriterion() {
            const tbody = document.getElementById("criteria-body");
            const currentCriteriaCount = tbody.querySelectorAll("tr").length;

            if (currentCriteriaCount >= optionCount) {
                alert(`Kh√¥ng th·ªÉ th√™m ti√™u ch√≠! S·ªë ti√™u ch√≠ t·ªëi ƒëa b·∫±ng s·ªë ph∆∞∆°ng √°n (${optionCount}).`);
                return;
            }

            const row = document.createElement("tr");
            const rowIndex = currentCriteriaCount + 1;

            let rowHtml = `<td><input type="text" name="criteria[]" class="form-control" placeholder="Nh·∫≠p ti√™u ch√≠" required></td>`;
            for (let i = 1; i <= optionCount; i++) {
                const isDiagonal = i === rowIndex;
                rowHtml += `<td><input type="text" name="option${i}[]" class="form-control" value="${isDiagonal ? '1' : ''}" ${isDiagonal ? 'readonly' : ''} required oninput="validateInput(this)" onblur="convertFractionToDecimal(this)"></td>`;
            }
            rowHtml += `<td><button type="button" class="btn btn-danger btn-sm" onclick="removeCriterion(this)">X</button></td>`;
            row.innerHTML = rowHtml;

            tbody.appendChild(row);
            updateHeaderFromCriteria();
            addSymmetryListeners();
        }

        function removeCriterion(button) {
            const row = button.closest("tr");
            row.remove();
            updateHeaderFromCriteria();
            addSymmetryListeners();
        }

        function addOptionColumn() {
            optionCount++;
            const headerRow = document.getElementById("header-row");

            const newHeader = document.createElement("th");
            newHeader.textContent = `Ph∆∞∆°ng √°n ${optionCount}`;
            headerRow.insertBefore(newHeader, headerRow.lastElementChild);

            const rows = document.querySelectorAll("#criteria-body tr");
            rows.forEach((row, index) => {
                const newCell = document.createElement("td");
                const isDiagonal = optionCount === index + 1;
                newCell.innerHTML = `<input type="text" name="option${optionCount}[]" class="form-control" value="${isDiagonal ? '1' : ''}" ${isDiagonal ? 'readonly' : ''} required oninput="validateInput(this)" onblur="convertFractionToDecimal(this)">`;
                row.insertBefore(newCell, row.lastElementChild);
            });

            updateHeaderFromCriteria();
            addSymmetryListeners();
        }

        function removeOptionColumn() {
            if (optionCount === 1) {
                alert("Ph·∫£i c√≥ √≠t nh·∫•t 1 ph∆∞∆°ng √°n!");
                return;
            }

            const headerRow = document.getElementById("header-row");
            headerRow.removeChild(headerRow.children[optionCount]);

            const rows = document.querySelectorAll("#criteria-body tr");
            rows.forEach(row => {
                row.removeChild(row.children[optionCount]);
            });

            optionCount--;
            addSymmetryListeners();
        }

        function updateHeaderFromCriteria() {
            const rows = document.querySelectorAll("#criteria-body tr");
            const headers = document.querySelectorAll("#header-row th");

            rows.forEach((row, index) => {
                const input = row.querySelector('input[name="criteria[]"]');
                input.addEventListener("input", () => {
                    const value = input.value.trim();
                    if (headers[index + 1]) {
                        headers[index + 1].textContent = value !== "" ? value : `Ph∆∞∆°ng √°n ${index + 1}`;
                    }
                });
                input.dispatchEvent(new Event("input"));
            });
        }

        function addSymmetryListeners() {
            const rows = document.querySelectorAll("#criteria-body tr");

            rows.forEach((row, rowIndex) => {
                const inputs = row.querySelectorAll('input[type="text"]');
                inputs.forEach((input, colIndex) => {
                    if (!input.hasAttribute("readonly")) {
                        input.removeEventListener("input", handleSymmetricInput);
                        input.addEventListener("input", handleSymmetricInput);
                    }
                });
            });
        }

        function handleSymmetricInput(event) {
            const input = event.target;
            const row = input.closest("tr");
            const rowIndex = Array.from(row.parentNode.children).indexOf(row); // Ch·ªâ s·ªë h√†ng (0-based)
            const colIndex = Array.from(row.querySelectorAll('input[type="text"]')).indexOf(input); // Ch·ªâ s·ªë c·ªôt (0-based, bao g·ªìm c·ªôt ti√™u ch√≠)
            let value = input.value.trim();
            let numericValue;

            // B·ªè qua n·∫øu gi√° tr·ªã ch∆∞a ho√†n ch·ªânh (v√≠ d·ª•: "1/")
            if (value.endsWith('/')) {
                return;
            }

            // X·ª≠ l√Ω ph√¢n s·ªë ho·∫∑c s·ªë th·ª±c
            let isFraction = false;
            let numerator, denominator;
            if (value.includes('/')) {
                [numerator, denominator] = value.split('/').map(Number);
                if (denominator === 0 || isNaN(numerator) || isNaN(denominator)) {
                    alert('Ph√¢n s·ªë kh√¥ng h·ª£p l·ªá! Vui l√≤ng nh·∫≠p ƒë·ªãnh d·∫°ng a/b (v√≠ d·ª•: 1/9) v·ªõi m·∫´u s·ªë kh√°c 0.');
                    input.value = '';
                    return;
                }
                numericValue = parseFloat((numerator / denominator).toFixed(4));
                isFraction = true;
            } else {
                numericValue = parseFloat(value);
            }

            // Ki·ªÉm tra h·ª£p l·ªá tr∆∞·ªõc khi t√≠nh ƒë·ªëi x·ª©ng
            if (isNaN(numericValue) || numericValue <= 0 || !validateInput(input)) {
                return;
            }

            if (numericValue > 0 && colIndex > 0) { // B·ªè qua c·ªôt ti√™u ch√≠ (colIndex = 0)
                const symmetricRowIndex = colIndex - 1; // Ch·ªâ s·ªë h√†ng ƒë·ªëi x·ª©ng (0-based)
                const symmetricColIndex = rowIndex + 1; // Ch·ªâ s·ªë c·ªôt ƒë·ªëi x·ª©ng
                const symmetricRow = document.querySelectorAll("#criteria-body tr")[symmetricRowIndex];
                if (symmetricRow) {
                    const symmetricInputs = symmetricRow.querySelectorAll('input[type="text"]');
                    if (symmetricColIndex < symmetricInputs.length && !symmetricInputs[symmetricColIndex].hasAttribute("readonly")) {
                        let symmetricValue;
                        if (isFraction) {
                            // N·∫øu gi√° tr·ªã ban ƒë·∫ßu l√† ph√¢n s·ªë, t√≠nh ngh·ªãch ƒë·∫£o tr·ª±c ti·∫øp t·ª´ t·ª≠ v√† m·∫´u
                            symmetricValue = denominator / numerator;
                        } else {
                            // T√≠nh ngh·ªãch ƒë·∫£o v√† t√¨m gi√° tr·ªã g·∫ßn nh·∫•t trong validValues
                            symmetricValue = 1 / numericValue;
                            // T√¨m gi√° tr·ªã g·∫ßn nh·∫•t trong validValues
                            symmetricValue = validValues.reduce((prev, curr) =>
                                Math.abs(curr - symmetricValue) < Math.abs(prev - symmetricValue) ? curr : prev
                            );
                        }
                        symmetricInputs[symmetricColIndex].value = symmetricValue.toString(); // G√°n gi√° tr·ªã ch√≠nh x√°c
                        validateInput(symmetricInputs[symmetricColIndex]);
                        console.log(`Updated symmetric at [${symmetricRowIndex + 1}, ${symmetricColIndex + 1}] with value: ${symmetricInputs[symmetricColIndex].value}`);
                    }
                }
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            updateHeaderFromCriteria();
            addSymmetryListeners();
        });

        document.getElementById("excel-file").addEventListener("change", function (e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: "array" });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                importExcelData(jsonData);
            };
            reader.readAsArrayBuffer(file);
        });

        function importExcelData(data) {
            if (data.length < 2) {
                alert("File Excel kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá!");
                return;
            }

            const headers = data[0];
            optionCount = headers.length - 1;

            const headerRow = document.getElementById("header-row");
            headerRow.innerHTML = `<th>Ti√™u ch√≠</th>`;
            for (let i = 1; i < headers.length; i++) {
                headerRow.innerHTML += `<th>${headers[i]}</th>`;
            }
            headerRow.innerHTML += `<th>X√≥a ti√™u ch√≠</th>`;

            document.getElementById("criteria-body").innerHTML = "";

            for (let i = 1; i < data.length; i++) {
                const row = document.createElement("tr");
                const rowData = data[i];

                let rowHtml = `<td><input type="text" name="criteria[]" class="form-control" value="${rowData[0] || ''}" required></td>`;
                for (let j = 1; j <= optionCount; j++) {
                    let value = rowData[j];
                    const isDiagonal = j === i;
                    if (isDiagonal) {
                        value = 1;
                    } else if (!isNaN(value) && value !== null && value !== '') {
                        value = parseFloat(value).toFixed(4);
                        if (!validValues.includes(parseFloat(value))) {
                            alert(`Gi√° tr·ªã ${value} trong file Excel kh√¥ng h·ª£p l·ªá! Ch·ªâ ƒë∆∞·ª£c nh·∫≠p: 1/9, 1/8, 1/7, 1/6, 1/5, 1/4, 1/3, 1/2, 1, 2, 3, 4, 5, 6, 7, 8, 9`);
                            return;
                        }
                    }

                    rowHtml += `<td><input type="text" name="option${j}[]" class="form-control" value="${value || ''}" ${isDiagonal ? 'readonly' : ''} required oninput="validateInput(this)" onblur="convertFractionToDecimal(this)"></td>`;
                }

                rowHtml += `<td><button type="button" class="btn btn-danger btn-sm" onclick="removeCriterion(this)">X</button></td>`;
                row.innerHTML = rowHtml;
                document.getElementById("criteria-body").appendChild(row);
            }

            updateHeaderFromCriteria();
            addSymmetryListeners();
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script>

        function convertFractionToDecimal(input) {
            let value = input.value.trim();
            if (value.includes('/')) {
                const [numerator, denominator] = value.split('/').map(Number);
                if (denominator === 0 || isNaN(numerator) || isNaN(denominator)) {
                    alert('Ph√¢n s·ªë kh√¥ng h·ª£p l·ªá! Vui l√≤ng nh·∫≠p ƒë·ªãnh d·∫°ng a/b (v√≠ d·ª•: 1/9) v·ªõi m·∫´u s·ªë kh√°c 0.');
                    input.value = '';
                    input.focus();
                    return;
                }
                let decimalValue = numerator / denominator;
                // T√¨m gi√° tr·ªã g·∫ßn nh·∫•t trong validValues
                decimalValue = validValues.reduce((prev, curr) =>
                    Math.abs(curr - decimalValue) < Math.abs(prev - decimalValue) ? curr : prev
                );
                input.value = decimalValue.toString(); // Chuy·ªÉn th√†nh s·ªë th·∫≠p ph√¢n (v√≠ d·ª•: 1/3 th√†nh 0.3333)
            }
        }


        document.addEventListener("DOMContentLoaded", function () {
            const btn = document.getElementById("btnHistory");
            const popup = document.getElementById("historyPopup");
            const matrixList = document.getElementById("matrixList");
            const optionList = document.getElementById("optionList");

            btn.addEventListener("click", function () {
                if (popup.style.display === "none") {
                    // L·∫•y l·ªãch s·ª≠ ma tr·∫≠n
                    fetch('/matrix-history')
                        .then(response => response.json())
                        .then(data => {
                            matrixList.innerHTML = "";
                            data.forEach(id => {
                                const li = document.createElement("li");
                                const link = document.createElement("a");
                                link.href = `/criteria-matrix?matrix_id=${id}`;
                                link.textContent = id;
                                link.style.display = 'block';
                                link.style.padding = '4px 0';
                                li.appendChild(link);
                                matrixList.appendChild(li);
                            });
                        });

                    // L·∫•y l·ªãch s·ª≠ c√°c ph∆∞∆°ng √°n
                    fetch('/option-history')
                        .then(response => response.json())
                        .then(data => {
                            optionList.innerHTML = "";
                            data.forEach(id => {
                                const li = document.createElement("li");
                                const link = document.createElement("a");
                                link.href = `/criteria-matrix?matrix_id=${id}`;
                                link.textContent = id;
                                link.style.display = 'block';
                                link.style.padding = '4px 0';
                                li.appendChild(link);
                                optionList.appendChild(li)

                            });
                        });

                    popup.style.display = "block";
                } else {
                    popup.style.display = "none";
                }
            });

            document.addEventListener("click", function (e) {
                if (!popup.contains(e.target) && e.target !== btn) {
                    popup.style.display = "none";
                }
            });
        });
    </script>
</body>

</html>